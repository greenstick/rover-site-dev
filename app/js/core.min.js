(function(){function u(e){var n={},r="#"+e,i=videojs(r,{controls:true,autoplay:false,preload:false});i.ready(function(){t.videos[e]=this});return t.videos}function a(){var e=t.width*.8,n=t.height*.8;if(e/n>=24/10){$("#video-1, #video-2, #video-3").height(n).width(n*(24/10))}else{$("#video-1, #video-2, #video-3").width(e).height(e*(10/24))}}function f(e){t.currentVideo=e;t.videos[e].currentTime(0);t.videos[e].play();o.openModal();$(o.element).removeClass("hide");$("#"+e).show()}function l(){o.closeModal();$(t.videoElement).fadeOut();t.videos[t.currentVideo].currentTime(0);t.videos[t.currentVideo].pause()}function h(e,t,n){$(e).scrollTo(t,{duration:n,axis:"x"})}function d(e,t,n){$(e).scrollTo(t,{duration:n,axis:"x"})}function m(e,t,n){$(e).scrollTo(t,{duration:n,axis:"x"})}var e=function(e){var t=this;t.wrapper=e.wrapper||"#wrapper",t.pageClass=e.page||".page",t.subPage=e.subPage||".subPage",t.menuMask=e.menuMask||"#nav-mask",t.fader=e.fader||".fader",t.isoFader=e.isoFader||".iso-fader",t.menu=e.menu||"#menu",t.menuOpen=e.menuOpen||".menu-open",t.menuSelection=e.menuSelection||"#menu .button",t.current=e.current||"current",t.resizer=e.resizer||"#resizer",t.videoElement=e.videoElement||".video-element",t.loadScreen=e.loadScreen||".load-screen",t.firstPage=e.firstPage||".firstPage",t.lastPage=e.lastPage||".lastPage",t.mobile=Modernizr.touch?true:false,t.scrollData={},t.scrolling=false,t.videos={},t.statementHistory="#statement1",t.autoScroll,t.statementScroll,t.startPosition,t.resizing,t.currentVideo,t.height,t.width,t.delta};e.prototype.bindScroll=function(){var e=this;if(e.mobile===true){$(e.pageClass).on("touchstart",function(t){e.touchStart(t)});$(e.pageClass).on("touchmove",function(t){e.touchMoveY(t)})}else{$(e.pageClass).on("mousewheel DOMMouseScroll MozMousePixelScroll wheel",function(t){e.scrollDelta(t)})}};e.prototype.scrollDelta=function(e){this.delta=0;if(!e)e=window.event;if(e.originalEvent.wheelDelta){this.delta=e.originalEvent.wheelDelta/120}else if(e.originalEvent.detail){this.delta=-e.originalEvent.detail/3}if(this.delta){e.preventDefault?e.preventDefault():e.returnValue=false;this.scrollDirectionY()}};e.prototype.touchStart=function(e){var t={x:0,y:0};t.x=e.originalEvent.pageX;t.y=e.originalEvent.pageY;this.startPosition=t};e.prototype.touchMoveY=function(e){var t={};t.y=this.startPosition.y-e.originalEvent.pageY;this.delta=t.y;if(Math.abs(this.delta)>=10){e.preventDefault?e.preventDefault():e.returnValue=false;this.scrollDirectionY()}};e.prototype.scrollDirectionY=function(){if(this.mobile===true){if(this.scrolling===false){if(this.delta>-1.25){this.scrolling=true;this.scrollPageY("next")}else if(this.delta<1.25){this.scrolling=true;this.scrollPageY("prev")}}}else{if(this.scrolling===false){if(this.delta<=-1){this.scrolling=true;this.scrollPageY("next")}else if(this.delta>=1){this.scrolling=true;this.scrollPageY("prev")}}}};e.prototype.scrollPageY=function(e){var t=this,n;if(e==="next"){if($(t.lastPage).hasClass(t.current)){t.scrolling=false;return}else{$("."+t.current).removeClass(t.current).next().addClass(t.current);n=$("."+t.current).attr("id");var r=setTimeout(function(){t.navTo(n,600,function(){y("#statement","#statement1",600)})},600)}}else{if($(t.firstPage).hasClass(t.current)){t.scrolling=false;return}else{$("."+t.current).removeClass(t.current).prev().addClass(t.current);n=$("."+t.current).attr("id");var r=setTimeout(function(){t.navTo(n,600,function(){y("#statement","#statement1",600)})},600)}}};e.prototype.navTo=function(e,t,n){var r=this;clearTimeout(r.autoScroll);clearInterval(r.statementScroll);var i=e!==null&&e!==undefined?"#"+e:location.hash?location.hash:"#home",s=i.substr(1),r=this;if(history.pushState){history.pushState({},document.title,i)}else{location.hash=i}r.scrolling=true;$("."+r.current).removeClass(r.current);$(i).addClass(r.current);$(r.menuSelection).removeClass("selected");$("#menu-"+s).addClass("selected");$(document).scrollTo(i,{duration:t,axis:"y",easing:"easeInQuad",onAfter:function(){r.scrolling=false;if(i==="#statement"){r.autoScroll=setTimeout(function(){var e=1;r.statementScroll=setInterval(function(){e++;if(e===4)e=1;y("#statement","#statement"+e,800)},5e3)},500)}if(typeof n==="function")n()}})};e.prototype.resize=function(e,t){var n=this;n.height=e.currentTarget.innerHeight;n.width=e.currentTarget.innerWidth;$("body").width(n.width).height(n.height);$(n.pageClass).width(n.width).height(n.height);$(n.subPage).width(n.width).height(n.height);if(typeof t==="function")t()};e.prototype.showResizer=function(){var e=this;$(e.resizer).addClass("resizing")};e.prototype.hideResizer=function(){var e=this;setTimeout(function(){$(e.resizer).removeClass("resizing")},600)};e.prototype.fadeElements=function(){var e=this;$(e.fader).fadeToggle()};e.prototype.fadeIsoElements=function(){var e=this;$(e.isoFader).toggleClass("faded")};e.prototype.toggleMenu=function(){var e=this;$(e.menu).toggleClass("active");$(e.menuOpen).toggleClass("close");$(e.menuMask).toggleClass("menu-dismiss")};e.prototype.menuOver=function(){var e=this;$(e.menuOpen).addClass("active")};e.prototype.menuOut=function(){var e=this;$(e.menuOpen).removeClass("active")};e.prototype.menuHoverOver=function(e){var t=this;$(e).addClass("hover")};e.prototype.menuHoverOut=function(){var e=this;$(e.menuSelection).removeClass("hover")};e.prototype.toggleNav=function(e,t){if(e===true){this.fadeElements();this.fadeIsoElements()}this.toggleMenu();if(typeof t==="function")t()};var t=new e({menu:"#navigation",menuSelection:".menu-item",resizer:"#resizing",firstPage:"#home",lastPage:"#credits"});$(t.menuOpen).on("click",function(e){t.toggleNav(true)});$(t.menuOpen).on("mouseover",function(e){t.menuOver()});$(t.menuOpen).on("mouseout",function(e){t.menuOut()});$(t.menuSelection).on("mouseover",function(e){t.menuHoverOver(e.currentTarget)});$(t.menuSelection).on("mouseout",function(e){t.menuHoverOut()});$(t.menuSelection).on("click",function(e){var n=$(this).data().to;t.toggleNav(false,function(){setTimeout(function(){t.navTo(n,600,function(){t.fadeElements();t.fadeIsoElements();y("#statement","#statement1",600)})},600)})});$(t.menuMask).on("click",function(e){t.toggleNav(true)});$(window).on("keydown",function(e){if(e.keyCode===40)e.preventDefault(),t.scrollPageY("next");if(e.keyCode===38)e.preventDefault(),t.scrollPageY("prev")});var n=function(e){var t=this;t.element=e.element,t.mask=e.mask||false,t.open=e.open,t.close=e.close;return this};n.prototype.openModal=function(){var e=this;if(this.mask!==false)$(e.mask).fadeIn();$(e.element).fadeIn()};n.prototype.closeModal=function(){var e=this;if(this.mask!==false)$(e.mask).fadeOut();$(e.element).fadeOut()};n.prototype.zipCode=function(e){var t=this;t.location=e.location,t.pattern=/(\d{5}?)/,t.zipcode=ko.observable(),t.valid=ko.computed(function(){if(typeof t.zipcode()==="undefined")return;if(t.zipcode().match(t.pattern)){return t.location+t.zipcode().substr(0,5)}})};var r=new n({element:"#zipcode-modal",mask:"#mask",open:".getTickets",close:".closeIcon"});var i=r.zipCode({location:"http://www.fandango.com/theRover_170724/movietimes?location="});ko.applyBindings(r,document.getElementById("zipcode-modal"));$(r.open).on("click",function(){r.openModal();t.fadeElements();t.fadeIsoElements();$("body").addClass("modal-open")});$(r.element+" "+r.close).on("click",function(){r.closeModal();t.fadeElements();t.fadeIsoElements();$("body").removeClass("modal-open")});$("#zipcode-modal .input").on("keyup",function(e){if(e.keyCode===13)$(".submit img").click()});var s=new n({element:"#release-dates",open:".release-open",close:".closeIcon"});$(s.open).on("click",function(){s.openModal()});$(s.element+" "+s.close).on("click",function(){s.closeModal()});var o=new n({element:"#video-players",mask:"#mask",open:".video-open",close:".closeIcon"});$(o.open).on("click",function(e){var n=$(this).data().video;t.fadeElements();t.fadeIsoElements();u(n);a();f(n);$("body").addClass("modal-open")});$(o.element+" "+o.close).on("click",function(e){l();t.fadeElements();t.fadeIsoElements();$("body").removeClass("modal-open")});var c=new n({element:"#galleryModal",mask:"#mask",open:".gallery-open",close:".closeIcon"});n.prototype.getGalleryImage=function(e){var t=e.source;$(c.element+" img").attr("src","");$(c.element+" img").attr("src",t)};$(c.open).on("click",function(){c.getGalleryImage($(this).data());t.fadeElements();t.fadeIsoElements();c.openModal();$("body").addClass("modal-open")});$(c.element+" "+c.close).on("click",function(){c.closeModal();S.layout();t.fadeElements();t.fadeIsoElements();$("body").removeClass("modal-open")});var p=1;$("#gallery .next").on("click",function(){if(p<16){p++}else{p=1}h(".gSlideContainer",".gContainer"+p,800)});$("#gallery .prev").on("click",function(){if(p>1){p--}else{p=16}h(".gSlideContainer",".gContainer"+p,800)});var v=1;$("#press .next").on("click",function(){if(v<9){v++}else{v=1}d(".pSlideContainer",".pContainer"+v,800)});$("#press .prev").on("click",function(){if(v>1){v--}else{v=9}d(".pSlideContainer",".pContainer"+v,800)});var g=1;$("#videos .next").on("click",function(){if(g<3){g++}else{g=1}m(".tSlideContainer",".tContainer"+g,800)});$("#videos .prev").on("click",function(){if(g>1){g--}else{g=3}m(".tSlideContainer",".tContainer"+g,800)});var y=function(e,n,r){t.statementHistory=n;$(e).scrollTo(n,{duration:r,axis:"x",easing:"easeInQuad"})};$("#statement1 .next").on("click",function(){clearInterval(t.statementScroll);y("#statement","#statement2",800)});$("#statement2 .next").on("click",function(){clearInterval(t.statementScroll);y("#statement","#statement3",800)});$("#statement2 .prev").on("click",function(){clearInterval(t.statementScroll);y("#statement","#statement1",800)});$("#statement3 .prev").on("click",function(){clearInterval(t.statementScroll);y("#statement","#statement2",800)});var b=document.querySelector("#press.page");var w=new Isotope(b,{itemSelector:".blurb"});var E=document.querySelector("#gallery");var S=new Isotope(E,{itemSelector:".galleryImg"});$(window).load(function(e){t.resize(e,function(){S.layout();w.layout();a();t.bindScroll();$("#video-players").addClass("hide");t.navTo(null,50,function(){setTimeout(function(){$(t.loadScreen).addClass("done")},200)})})});$(window).on("resize",function(e){var n;t.showResizer();clearTimeout(t.resizing);t.resizing=setTimeout(function(){t.resize(e,function(){w.layout();a();S.layout();n=$("."+t.current).attr("id");h(".gSlideContainer",".gContainer"+p,800);d(".pSlideContainer",".pContainer"+v,800);t.navTo(n,50,function(){t.hideResizer();y("#statement",t.statementHistory,0)})})},400)});var x=function(e){var t=e.toString().split(".");if(t[0].length>=4){t[0]=t[0].replace(/(\d)(?=(\d{3})+$)/g,"$1,")}if(t[1]&&t[1].length>=5){t[1]=t[1].replace(/(\d{3})/g,"$1 ")}return t.join(".")};var T=function(e){var t=this;t.geoData=e.geoData,t.coreData=e.coreData,t.wrapper=e.wrapper||"#interactiveWrapper",t.container=e.container||"#container",t.projection=e.projection||"mercator",t.stroke=e.stroke||"#000000",t.strokeWidth=e.strokeWidth||"2px",t.width=e.width||"100%",t.height=e.height||"100%",t.viewBoxX=e.viewBoxX||1020,t.viewBoxY=e.viewBoxY||680,t.scale=e.scale||1,t.translateX=e.translateX||0,t.translateY=e.translateY||0,t.layers=e.layers-1||4,t.pathClass=e.pathClass||"country",t.bgPath=e.bgPath||"../img/map-interactive/background-",t.bgImgType=e.bgImgType||".png",t.sort=e.sort||"ascending",t.ttObj=e.tooltip||null,t.ttElement=e.tooltip.ttElement||false,t.ttClasses=e.tooltip.ttClasses||false,t.ttOffsetX=e.tooltip.ttOffsetX||null,t.ttOffsetY=e.tooltip.ttOffsetY||null,t.ttFollow=e.tooltip.ttFollow||true,t.defaults=e.defaults,t.defFilter=e.defaults.filter,t.defChrono=e.defaults.chronology,t.chronoCache,t.loadedData,t.settings={geoData:t.geoData,coreData:t.coreData,wrapper:t.wrapper,container:t.container,projection:t.projection,stroke:t.stroke,strokeWidth:t.strokeWidth,width:t.width,height:t.height,scale:t.scale,translateX:t.translateX,translateY:t.translateY,layers:t.layers,pathClass:t.pathClass,sort:t.sort,ttObj:t.ttObj,defaults:t.defaults},t.projection=d3.geo[t.projection](),t.svg=d3.select(t.container).append("svg").attr("width",t.width).attr("height",t.height).attr("viewBox","0 0 "+t.viewBoxX+" "+t.viewBoxY),t.path=d3.geo.path().projection(t.projection),t.world=t.svg.append("g").attr("id","world").attr("transform","scale("+t.scale+"), translate("+t.translateX+", "+t.translateY+")"),t.metric=ko.observable(),t.keyLabels=ko.observableArray([]),t.filterText=ko.observable(),t.description=ko.observable(),t.dataSource=ko.observable(),t.background=ko.observable(),t.loadData=function(){var e=this;queue().defer(d3.json,e.geoData).defer(d3.json,e.coreData).await(e.loaded)},t.loaded=function(e,n,r){t.loadedData=r;t.draw(n);t.filter(t.defFilter,t.defChrono,t.loadedData);t.setEvents()},t.draw=function(e,n){t.world.selectAll("path").data(e.features).enter().append("path").attr("d",t.path).attr("id",function(e){return e.id}).attr("class",t.pathClass).attr("stroke",t.stroke).attr("stroke-width",t.strokeWidth);typeof n==="function"?n():void 0},t.filter=function(e,n,r,i){var r=r||t.loadedData,s=[],o=[],u,a;if(r[e].image.length){for(var f=0;f<r[e].colorClasses.length;f++){o.push(r[e].colorClasses[f])}}else{for(var f=0;f<r[e].countries.length;f++){if(r[e].countries[f][n]!==null){s.push(r[e].countries[f][n])}}u=Math.max.apply(null,s),a=Math.min.apply(null,s);for(var f=0;f<r[e].countries.length;f++){if(r[e].countries[f][n]!==null){d3.select("#"+r[e].countries[f].id).attr("class",function(i){var s=t.bucket(r[e].countries[f][n],u,a,r[e].layers||t.layers,r[e].color,r[e].sort||t.sort);o.push(s);return s+" "+t.pathClass})}else{d3.select("#"+r[e].countries[f].id).attr("class",t.pathClass)}}}t.generateKey(e,n,r,o,r[e].sort||t.sort,u,a);t.dropdown(e,r);this.currentFilter=e;typeof i==="function"?i():void 0},t.bucket=function(e,t,n,r,i,s){var o=d3.scale.quantize().domain([t,n]).range(d3.range(r).map(function(e){return s==="descending"||s==="dsc"||s===0?i+"-"+(r-(e+1)):i+"-"+e}));return o(e)},t.generateKey=function(e,n,r,i,s,o,u){var a=[],f=new Array(r[e].layers),l,c=((o-u)/r[e].layers).toFixed(0);t.keyLabels([]);for(var h=0;h<i.length;h++){if($.inArray(i[h],a)===-1){a.push(i[h])}}l=r[e].layers-(a.length-1);for(var h=0;h<a.length;h++){var p=s==="descending"||s==="dsc"||s===0?parseInt(a[h].split("-")[1]-r[e].layers):r[e].layers-a[h].split("-")[1]-1;f.splice(p,1,a[h])}for(var h=0;h<f.length;h++){t.keyLabels.push({color:f[h],label:r[e].labels[n][h]})}t.metric(r[e].metric);t.description(r[e].description.toUpperCase());t.dataSource(r[e].source.toUpperCase())},t.dropdown=function(e,n,r){t.filterText(n[e].title)},t.chronology=function(e){this.chronoCache=e||this.chronoCache||this.defChrono;return this.chronoCache},t.setBackground=function(e){t.background(t.bgPath+(e||this.chronoCache||this.defChrono)+this.bgImgType)},t.setEvents=function(){if(t.tooltip!==null){d3.selectAll("."+t.pathClass).on("mouseover",function(e){t.bindCountryData(t.currentFilter,e.id,t.ttClasses)});$("."+t.pathClass).on("click mouseover",function(e){var n,r;if(t.ttFollow===true){n=$(t.wrapper).offset();$("#"+t.ttElement).toggleClass("active").css("position","absolute").css("left",e.pageX+t.ttOffsetX+"px").css("top",e.pageY-n.top+t.ttOffsetY+"px")}else{r=$("#"+t.ttElement).offset();$("#"+t.ttElement).toggleClass("active").css("position","absolute").css("left",r.left+t.ttOffsetX+"px").css("top",r.top+t.ttOffsetY+"px")}});$("."+t.pathClass).on("mouseout",function(e){$("#"+t.ttElement).removeClass("active");d3.selectAll("."+t.pathClass).attr("stroke-width",t.strokeWidth)})}},t.formatData=function(e,n){var r=t.loadedData[e].format,i;if(r!=null){if(typeof r!=="object"){if(typeof n==="number"){if(r==="monetary"){i="$"+x(n)}else if(r==="percentage"){i=n+"%"}else{i=x(n)}}else if(typeof n==="string"){i=n.toUpperCase()}else{i=n}}else if(typeof r==="object"){if(r.array&&typeof n==="string"){i=n.toUpperCase()}else{i=r.array[n-1]}}else{i=n}}else{i=n}return i},t.bindCountryData=function(e,n,r){var i;for(var s=0;s<t.loadedData[e].countries.length;s++){if(t.loadedData[e].countries[s].id===n){i=t.loadedData[e].countries[s];break}}d3.selectAll("."+t.pathClass).attr("stroke-width",t.strokeWidth);d3.select("#"+i.id).attr("stroke-width",t.strokeHover);for(var s=0;s<r.length;s++){var o;o=i[r[s]]!==null?this.formatData(e,i[r[s]]):"N/A";d3.select("#"+t.pathClass+"-"+r[s]+" .data").text(o)}}};T.prototype.init=function(){this.loadData();this.setBackground(this.chronology())};T.prototype.updateFilter=function(e){this.filter(e,this.chronoCache||this.defChrono)};T.prototype.updateChronology=function(e){this.filter(this.currentFilter,this.chronology(e));this.setBackground()};var N={geoData:"js/json/world-data.json",coreData:"js/json/core-data.json",wrapper:"#map-wrapper",container:"#map-container",stroke:"rgba(0, 0, 0, .5)",strokeWidth:"0px",strokeHover:"1px",scale:"1.2",projection:"mercator",viewBoxX:1298,viewBoxY:672,translateX:64,translateY:152,bgPath:"img/map-interactive/background-",bgImgType:".jpg",tooltip:{ttElement:"map-tooltip",ttClasses:["country","present","future"],ttOffsetX:10,ttOffsetY:-110},defaults:{filter:"economicWealth",chronology:"present"}},C=new T(N);ko.applyBindings(C,document.getElementById("map"));C.init();$("#map-mask .exit").on("click",function(){$("#map-mask").fadeOut()});$(".dropdown").on("click mouseenter",function(){$(this).addClass("active")});$(".dropdown").on("mouseleave",function(){$(this).removeClass("active")});$(".filter").on("click",function(e){$(".filter").removeClass("active");$("#"+e.currentTarget.id).addClass("active");C.updateFilter(e.currentTarget.id)});$(".chronology").on("click",function(e){$(".chronology").removeClass("active");$("#"+e.currentTarget.id).addClass("active");C.updateChronology(e.currentTarget.id)});jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeInQuad",easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n}})})(jQuery,d3,ko)